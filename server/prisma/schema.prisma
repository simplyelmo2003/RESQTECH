// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Alert {
  id           String   @id @default(cuid())
  title        String
  description  String
  areaAffected String?
  createdAt    DateTime @default(now())

  @@map("alert")
}

model Barangay {
  id                String        @id @default(cuid())
  displayName       String
  address           String?
  lat                Float?
  lng                Float?
  evacCenters       EvacCenter[]
  incidentReports   IncidentReport[]
  affectedPeople    AffectedPerson[]

  @@map("barangay")
}

model Contact {
  id           String  @id @default(cuid())
  name         String
  organization String?
  phoneNumber  String
  type         String
  description  String?

  @@map("contact")
}

model EvacCenter {
  id               String   @id @default(cuid())
  name             String
  address          String?
  barangayId       String?
  lat              Float?
  lng              Float?
  capacity         Int      @default(0)
  contact          String?
  createdAt        DateTime @default(now())
  currentOccupancy Int      @default(0)
  services         String?
  status           String   @default("Open")
  updatedAt        DateTime @default(now())
  barangay         Barangay? @relation(fields: [barangayId], references: [id])

  @@map("evaccenter")
}

model IncidentReport {
  id                  String   @id @default(cuid())
  description         String
  status              String   @default("Pending")
  createdAt           DateTime @default(now())
  imageUrls           Json?
  adminNotes          String?
  barangayId          String?
  latitude            Float?
  locationDescription String?
  longitude           Float?
  reporterContact     String?
  reporterName        String   @default("Anonymous")
  type                String   @default("Other")
  updatedAt           DateTime @default(now())
  affectedPeople      AffectedPerson[]
  barangay            Barangay? @relation(fields: [barangayId], references: [id])

  @@map("incidentreport")
}

model AffectedPerson {
  id            String   @id @default(cuid())
  name          String
  sex           String?
  age           Int?
  purok         String?
  birthday      DateTime?
  affected      Boolean  @default(false)
  evacuated     Boolean  @default(false)
  barangayId    String?
  incidentReportId String
  incidentReport IncidentReport @relation(fields: [incidentReportId], references: [id], onDelete: Cascade)
  barangay      Barangay? @relation(fields: [barangayId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("affectedperson")
}

model LogEntry {
  id        String   @id @default(cuid())
  level     String
  message   String
  meta      String?
  createdAt DateTime @default(now())

  @@map("logentry")
}

model Message {
  id                  String   @id @default(cuid())
  conversationId      String?
  sender              String
  body                String
  senderName          String   @default("System")
  senderRole          String   @default("admin")
  barangayId          String?
  isRead              Boolean  @default(false)
  readAt              DateTime?
  recipientBarangayId String?
  recipientRole       String   @default("all")
  subject             String   @default("")
  type                String   @default("general")
  createdAt           DateTime @default(now())

  @@map("message")
}

model News {
  id           String   @id @default(cuid())
  title        String
  content      String
  category     String?
  mediaType    String?
  mediaUrl     String?
  thumbnailUrl String?
  publishedAt  DateTime @default(now())
  author       String?
  source       String?

  @@map("news")
}

model User {
  id         String   @id @default(cuid())
  username   String   @unique
  email      String?
  password   String
  role       String
  barangayId String?
  createdAt  DateTime @default(now())

  @@map("user")
}
